# üîê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å AI Server

> **–í–µ—Ä—Å–∏—è:** 1.1  
> **–î–∞—Ç–∞:** 30.11.2025  
> **–ê–≤—Ç–æ—Ä:** –ö—É—Ä–µ–∏–Ω –ú.–ù.

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä](#-–æ–±–∑–æ—Ä)
2. [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#-–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
3. [–ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è](#-–∫–æ–º–∞–Ω–¥—ã-—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
4. [–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–ª—é—á–∞](#-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è-–∫–ª—é—á–∞)
5. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API](#-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-api)
6. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
7. [–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º](#-—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–ø—Ä–æ–±–ª–µ–º)

---

## üéØ –û–±–∑–æ—Ä

ApiAi –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å —É–¥–∞–ª–µ–Ω–Ω—ã–º AI Server –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏. –î–ª—è —Ä–∞–±–æ—Ç—ã —Ç—Ä–µ–±—É–µ—Ç—Å—è:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| `telegram_url` | URL API —Å–µ—Ä–≤–µ—Ä–∞ |
| `telegram_key` | –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ |

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ       ApiAi         ‚îÇ    HTTP Request    ‚îÇ      AI Server      ‚îÇ
‚îÇ   (Desktop App)     ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí  ‚îÇ   (VPS Server)      ‚îÇ
‚îÇ                     ‚îÇ                    ‚îÇ                     ‚îÇ
‚îÇ  config_qt.json:    ‚îÇ    AI Response     ‚îÇ  .env:              ‚îÇ
‚îÇ  - telegram_url     ‚îÇ ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ  - API_SECRET_KEY   ‚îÇ
‚îÇ  - telegram_key     ‚îÇ                    ‚îÇ  - API_URL          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á —Å —Å–µ—Ä–≤–µ—Ä–∞ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å

```bash
cd /path/to/ApiAi
source venv/bin/activate  # macOS/Linux
# –∏–ª–∏: .\.venv\Scripts\activate  # Windows

python scripts/sync_telegram_api.py --fetch
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
python scripts/sync_telegram_api.py --test
```

### 3. –ì–æ—Ç–æ–≤–æ!

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ ApiAi ‚Äî AI –ø–æ–∏—Å–∫ –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å.

---

## üõ† –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### sync_telegram_api.py ‚Äî –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è API –∫–ª—é—á–∞

```bash
# –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º (–º–µ–Ω—é)
python scripts/sync_telegram_api.py

# –ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á —Å —Å–µ—Ä–≤–µ—Ä–∞ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å
python scripts/sync_telegram_api.py --fetch

# –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
python scripts/sync_telegram_api.py --show

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á
python scripts/sync_telegram_api.py --key "–≤–∞—à_–∫–ª—é—á"

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–ª—é—á –∏ URL
python scripts/sync_telegram_api.py --key "–∫–ª—é—á" --url "http://IP:8000/ai_query"

# –¢–µ—Å—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å API
python scripts/sync_telegram_api.py --test
```

### ai_search.py ‚Äî AI –ø–æ–∏—Å–∫

```bash
# –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫
python scripts/ai_search.py "TPS54302"

# JSON –≤—ã–≤–æ–¥
python scripts/ai_search.py "MAX232" --json

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ñ–∞–π–ª
python scripts/ai_search.py "STM32F103" --output result.txt

# –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
python scripts/ai_search.py --list-prompts
```

---

## üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–ª—é—á–∞

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
python scripts/sync_telegram_api.py --fetch
```

–°–∫—Ä–∏–ø—Ç:
1. –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ SSH
2. –ü–æ–ª—É—á–∞–µ—Ç `API_SECRET_KEY` –∏–∑ `.env`
3. –û–±–Ω–æ–≤–ª—è–µ—Ç `config_qt.json` –≤ –ø—Ä–æ–µ–∫—Ç–µ
4. –û–±–Ω–æ–≤–ª—è–µ—Ç `config_qt.json` –≤ –ø–∞–ø–∫–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

### –†—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

**–®–∞–≥ 1:** –ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
```bash
ssh -p 22542 root@YOUR_SERVER_IP
grep API_SECRET_KEY /opt/TelegramHelper/.env
```

**–®–∞–≥ 2:** –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á –≤ ApiAi

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `config_qt.json`:
```json
{
  "api_keys": {
    "telegram_url": "http://YOUR_SERVER_IP:8000/ai_query",
    "telegram_key": "–≤–∞—à_–∫–ª—é—á_–∑–¥–µ—Å—å"
  }
}
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# curl (macOS/Linux)
curl http://YOUR_SERVER_IP:8000/health

# PowerShell (Windows)
Invoke-WebRequest -Uri "http://YOUR_SERVER_IP:8000/health"
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
```json
{"status":"healthy","timestamp":...,"anthropic_available":true}
```

### –¢–µ—Å—Ç AI –∑–∞–ø—Ä–æ—Å–∞

```bash
python scripts/ai_search.py "NE555" --json
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
```json
{
  "response": "NE555 - —ç—Ç–æ —Ç–∞–π–º–µ—Ä...",
  "provider": "anthropic",
  "status": "success"
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç

```bash
python scripts/sync_telegram_api.py --test
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

| –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ | –ü—É—Ç—å |
|-----------|------|
| **–ü—Ä–æ–µ–∫—Ç** | `ApiAi/config/config_qt.json` |
| **macOS** | `~/Library/Application Support/ApiAi/config_qt.json` |
| **Windows** | `%APPDATA%\ApiAi\config_qt.json` |
| **Linux** | `~/.config/ApiAi/config_qt.json` |

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ config_qt.json

```json
{
  "api_keys": {
    "anthropic": "",
    "openai": "",
    "ollama_url": "http://localhost:11434",
    "telegram_url": "http://YOUR_SERVER_IP:8000/ai_query",
    "telegram_key": "754c7afb2b146882181bac0af01f21607158e3ffba8d5853628364b61101464c",
    "telegram_hmac_secret": ""
  },
  "telegram_security": {
    "app_id": "apiai-v1",
    "enable_signature": true,
    "verify_ssl": false
  }
}
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã API

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π |
|----------|----------|--------------|
| `telegram_url` | URL —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ `/ai_query` | ‚úÖ |
| `telegram_key` | –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á (64 —Å–∏–º–≤–æ–ª–∞ hex) | ‚úÖ |
| `telegram_hmac_secret` | HMAC —Å–µ–∫—Ä–µ—Ç –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ | ‚ùå |
| `app_id` | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | ‚ùå |
| `enable_signature` | –í–∫–ª—é—á–∏—Ç—å –ø–æ–¥–ø–∏—Å—å –∑–∞–ø—Ä–æ—Å–æ–≤ | ‚ùå |

---

## üîß –ö–æ–º–∞–Ω–¥—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ API –∫–ª—é—á–æ–º

```bash
cd /opt/TelegramHelper

# –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–π –∫–ª—é—á
./scripts/api_key.sh show

# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π –∫–ª—é—á
./scripts/api_key.sh generate

# –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
docker compose down && docker compose up -d
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –ö–ª—é—á –≤ .env
grep API_SECRET_KEY .env

# –ö–ª—é—á –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker exec telegram-helper env | grep API_SECRET_KEY

# –°—Ç–∞—Ç—É—Å API
curl http://localhost:8000/health
```

---

## üÜò –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### ‚ùå –û—à–∏–±–∫–∞ "Connection refused"

**–ü—Ä–∏—á–∏–Ω–∞:** API —Å–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
docker ps | grep telegram-api
# –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –∑–∞–ø—É—Å—Ç–∏—Ç—å
docker compose up -d
```

### ‚ùå –û—à–∏–±–∫–∞ "401 Unauthorized"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á
python scripts/sync_telegram_api.py --fetch
```

### ‚ùå –û—à–∏–±–∫–∞ "Timeout"

**–ü—Ä–∏—á–∏–Ω–∞:** –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –º–µ–¥–ª–µ–Ω–Ω—ã–π

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å: `ping YOUR_SERVER_IP`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—Ç: `curl http://YOUR_SERVER_IP:8000/health`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å firewall –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### ‚ùå SSH –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–≤–µ—Ä–Ω—ã–π –ø–æ—Ä—Ç –∏–ª–∏ –∫–ª—é—á–∏

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
ssh -p 22542 root@YOUR_SERVER_IP "echo OK"
```

### ‚ùå –ö–ª—é—á –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –ø–∞–ø–∫—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –ø—É—Ç–∏
python scripts/sync_telegram_api.py --show

# –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –æ–±–∞ —Ñ–∞–π–ª–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
```

---

## üìö –°–≤—è–∑–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [AI_INTEGRATION_GUIDE.md](AI_INTEGRATION_GUIDE.md) ‚Äî –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- [CLI_USAGE.md](CLI_USAGE.md) ‚Äî –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
- [TelegramHelper/VPS_GUIDE.md](../../TelegramHelper/VPS_GUIDE.md) ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–æ–º

---

## üîë –ö—Ä–∞—Ç–∫–∞—è —à–ø–∞—Ä–≥–∞–ª–∫–∞

```bash
# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á —Å —Å–µ—Ä–≤–µ—Ä–∞
python scripts/sync_telegram_api.py --fetch

# –ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
python scripts/sync_telegram_api.py --show

# –¢–µ—Å—Ç AI –ø–æ–∏—Å–∫–∞
python scripts/ai_search.py "NE555"

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ: –Ω–æ–≤—ã–π –∫–ª—é—á
./scripts/api_key.sh generate && docker compose down && docker compose up -d
```

---

*–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞: 1.1*  
*–ê–≤—Ç–æ—Ä: –ö—É—Ä–µ–∏–Ω –ú.–ù.*
